///////////////////
// DEFAULT SETTINGS
///////////////////

// Classes
$rr-spacing-class-prefix: '' !default;
$rr-spacings-generate-types: ('mt', 'mr', 'mb', 'ml', 'my', 'mx', 'ma', 'pt', 'pr', 'pb', 'pl', 'py', 'px', 'pa') !default;

$rr-spacing-add-gutter: true !default;

// Spacings
$rr-spacings: () !default;

// Defaults
$rr-spacing-map-defaults: (
	'spacing': null,
	'types': $rr-spacings-generate-types
) !default;

$rr-spacings-default: map-default($rr-spacings) !default;

// Print output for this module
$rr-generate-spacings: $rr-generate-classes !default;
$rr-generate-spacings-margin: $rr-generate-spacings !default;
$rr-generate-spacings-padding: $rr-generate-spacings !default;
$rr-generate-spacings-unset: $rr-generate-spacings !default;
$rr-generate-spacings-auto: $rr-generate-spacings !default;
$rr-generate-spacings-gutter: $rr-generate-spacings !default;

////////////
// FUNCTIONS
////////////

// Check if an entry exists
@function spacing-exists($name) {
	@return entry-exists($rr-spacings, $name);
}

// Gets an entry by name
@function spacing-entry($name: null) {
	@return get-entry-by-name($rr-spacings, $name, $rr-spacings-default);
}

// Get an entry property value by name
@function spacing-property($name, $property) {
	@return get-entry-property(
		$rr-spacings,
		$name,
		$property,
		$rr-spacing-map-defaults,
		$rr-spacings-default
	);
}

// Get spacing value by name
@function spacing-value($name: null) {
	@return get-entry-value($rr-spacings, $name, 'spacing', $rr-spacings-default);
}

// Get spacing properties by type
@function spacing-properties-by-type($spacing, $type) {
	$spacing-properties: ();
	$spacing-value: $spacing;

	// Get value from map if not directly defined by list
	@if is-map($spacing) {
		$spacing-value: map-get($spacing, 'spacing');
	}

	@if is-not-null($spacing-value) {
		@if $type == 'mt' {
			$spacing-properties: (
				margin-top: $spacing-value
			);
		} @else if $type == 'mr' {
			$spacing-properties: (
				margin-right: $spacing-value
			);
		} @else if $type == 'mb' {
			$spacing-properties: (
				margin-bottom: $spacing-value
			);
		} @else if $type == 'ml' {
			$spacing-properties: (
				margin-left: $spacing-value
			);
		} @else if $type == 'my' {
			$spacing-properties: (
				margin-top: $spacing-value,
				margin-bottom: $spacing-value
			);
		} @else if $type == 'mx' {
			$spacing-properties: (
				margin-left: $spacing-value,
				margin-right: $spacing-value
			);
		} @else if $type == 'ma' {
			$spacing-properties: (
				margin: $spacing-value
			);
		} @else if $type == 'pt' {
			$spacing-properties: (
				padding-top: $spacing-value
			);
		} @else if $type == 'pr' {
			$spacing-properties: (
				padding-right: $spacing-value
			);
		} @else if $type == 'pb' {
			$spacing-properties: (
				padding-bottom: $spacing-value
			);
		} @else if $type == 'pl' {
			$spacing-properties: (
				padding-left: $spacing-value
			);
		} @else if $type == 'py' {
			$spacing-properties: (
				padding-top: $spacing-value,
				padding-bottom: $spacing-value
			);
		} @else if $type == 'px' {
			$spacing-properties: (
				padding-left: $spacing-value,
				padding-right: $spacing-value
			);
		}  @else if $type == 'pa' {
			$spacing-properties: (
				padding: $spacing-value
			);
		}
	}

	@return $spacing-properties;
}

/////////////////////
// INTERNAL FUNCTIONS
/////////////////////

// Convert entry to css properties map
@function spacing-to-css-properties($spacing, $type) {
	// Set properties
	$return: spacing-properties-by-type(
		spacing-value($spacing),
		$type
	);

	// Append breakpoint overwrites if exists
	$return: append-entry-breakpoint-overwrites(
		$spacing,
		$return,
		'spacing-to-css-properties',
		$type
	);

	@return $return;
}

// Prepare map for property classes
@function spacing-property-classes() {
	$property-classes: ();

	// Append defined classes
	@each $class-name, $spacing in $rr-spacings {
		$types: spacing-property($class-name, 'types');

		@if is-list($types) {
			@each $type in $types {
				$property-classes: map-append(
					$property-classes,
					spacing-to-css-properties($spacing, $type),
					$type + '-' + $class-name
				);
			}
		}
	}

	// Append gutter classes
	@if $rr-generate-spacings-gutter {
		@if is-list($rr-spacings-generate-types) {
			$gutters: ();

			@each $breakpoint-name, $breakpoint in $rr-grid-breakpoints {
				$gutters: map-append($gutters, grid-gutter($breakpoint-name), $breakpoint-name)
			}

			@each $type in $rr-spacings-generate-types {
				$gutter-spacing: (
					'spacing': grid-gutter(),
					'breakpoints': $gutters
				);

				$property-classes: map-append(
					$property-classes,
					spacing-to-css-properties($gutter-spacing, $type),
					$type + '-' + $rr-global-gutter-class
				);
			}
		}
	}

	// Append auto classes
	@if $rr-generate-spacings-auto {
		@if is-list($rr-spacings-generate-types) {
			@each $type in $rr-spacings-generate-types {
				@if in-list(('mt', 'mr', 'mb', 'ml', 'my', 'mx', 'ma'), $type) {
					$property-classes: map-append(
						$property-classes,
						spacing-to-css-properties(auto, $type),
						$type + '-' + $rr-global-auto-class
					);
				}
			}
		}
	}

	// Append unset class
	@if $rr-generate-spacings-unset {
		@if is-list($rr-spacings-generate-types) {
			@each $type in $rr-spacings-generate-types {
				$property-classes: map-append(
					$property-classes,
					spacing-to-css-properties(0, $type),
					$type + '-' + $rr-global-unset-class
				);
			}
		}
	}

	@return $property-classes;
}

/////////
// MIXINS
/////////

// Output spacing by name
@mixin spacing($name: null, $type: 'ma') {
	$spacing-value: spacing-value($name);

	@if is-not-null($spacing-value) {
		@include generate-properties(spacing-properties-by-type($spacing-value, $type));
	}
}

/////////
// OUTPUT
/////////

@mixin generate-spacing-module-output($breakpoint-prefix, $breakpoint-name: '') {
	@if $rr-generate-spacings {
		$rr-spacings-new: $rr-spacings;

		// Append gutter spacing
		$gutters: ();

		@each $breakpoint-name, $breakpoint in $rr-grid-breakpoints {
			@if $breakpoint-name != $rr-grid-breakpoints-default {
				$gutters: map-append($gutters, grid-gutter($breakpoint-name), $breakpoint-name);
			}
		}

		@if $rr-generate-spacings-gutter {
			$rr-spacings-new: map-append(
				$rr-spacings-new,
				(
					'spacing': grid-gutter($breakpoint-name),
					'breakpoints': $gutters
				),
				$rr-global-gutter-class
			);
		}

		// Append auto spacing
		@if $rr-generate-spacings-auto {
			$rr-spacings-new: map-append(
				$rr-spacings-new,
				(
					'spacing': auto,
					'padding': false
				),
				$rr-global-auto-class
			);
		}

		// Append spacing unset
		@if $rr-generate-spacings-unset {
			$rr-spacings-new: map-append(
				$rr-spacings-new,
				unset,
				$rr-global-unset-class
			);
		}

		@each $spacing-name, $spacing-entry in $rr-spacings-new {
			$spacing-value: get-value-by-entry($spacing-entry, 'spacing', $breakpoint-name);
			$breakpoint-overwrites: entry-has-breakpoint-overwrite($spacing-entry, $breakpoint-name);
			$generate-margin: map-maybe-get($spacing-entry, 'margin', $rr-generate-spacings-margin);
			$generate-padding: map-maybe-get($spacing-entry, 'padding', $rr-generate-spacings-padding);

			@if $generate-margin {
				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'mt-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (margin-top: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'mr-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (margin-right: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'mb-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (margin-bottom: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'ml-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (margin-left: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'my-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (margin-top: $spacing-value, margin-bottom: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'mx-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (margin-left: $spacing-value, margin-right: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'ma-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (margin: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);
			}

			@if $generate-padding {
				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'pt-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (padding-top: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'pr-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (padding-right: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'pb-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (padding-bottom: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'pl-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (padding-left: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'py-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (padding-top: $spacing-value, padding-bottom: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'px-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (padding-left: $spacing-value, padding-right: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);

				@include generate-output-by-class(
					$class: $spacing-name,
					$prefix: 'pa-',
					$breakpoint-prefix: $breakpoint-prefix,
					$properties: (padding: $spacing-value),
					$breakpoint-overwrites: $breakpoint-overwrites
				);
			}
		}
	}
}
